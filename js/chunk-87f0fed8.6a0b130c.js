(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-87f0fed8"],{"88b0":function(t,a,s){"use strict";s("b39a")},"8cd9":function(t,a,s){"use strict";s.r(a);var i=function(){var t=this,a=t._self._c;return a("div",{staticClass:"wrap"},[t.isLoading?a("div",{staticClass:"loading"},[a("div",{staticClass:"loading-item fas fas fa-apple-alt"}),a("div",{staticClass:"loading-item fas fa-lemon"}),a("div",{staticClass:"loading-item fas fa-carrot"})]):t._e(),t._m(0),a("section",[a("div",{staticClass:"container"},[t._m(1),a("table",{staticClass:"table text-center"},[t._m(2),a("tbody",t._l(t.cart.carts,(function(s){return a("tr",{key:s.id},[a("td",{staticClass:"align-middle"},[t._v(" "+t._s(s.product.title)+" ")]),a("td",{staticClass:"align-middle p-0",on:{change:t.finalTotal}},[t._v(" "+t._s(s.qty)+" "+t._s(s.product.unit)+" ")]),a("td",{staticClass:"align-middle smallPhoneHide"},[t._v(t._s(t._f("currency")(s.product.price)))]),a("td",{staticClass:"align-middle"},[t._v(" "+t._s(t._f("currency")(s.qty*(s.product.price?s.product.price:s.product.origin_price)))+" ")]),a("td",{staticClass:"align-middle"},[a("button",{staticClass:"btn btn-outline-danger btn-sm",attrs:{type:"button"},on:{click:function(a){return t.removeCart(s.product_id)}}},[a("i",{staticClass:"far fa-trash-alt"})])])])})),0)]),a("div",{staticClass:"cart"},[t.cart.carts?a("p",{staticClass:"text-right"},[a("span",[t._v("總計共")]),a("b",[t._v(t._s(t.cart.carts.length))]),a("span",[t._v("種商品")])]):t._e(),a("p",{staticClass:"text-right",staticStyle:{"font-size":"22px"}},[t._v("總計:"+t._s(t._f("currency")(t.total)))]),t.cart.final_total!==t.cart.total?a("p",{staticClass:"text-right",staticStyle:{"font-size":"22px"}},[t._v("折扣價:"+t._s(t._f("currency")(t.final_total)))]):t._e(),a("p",{staticClass:"text-right text-primary py-2"},[t._v("(免運費)信用卡付款")]),a("div",{staticClass:"clearfix py-2"},[a("button",{staticClass:"btn btn-outline-primary btn-sm float-right rounded-0 btn-custom",staticStyle:{height:"28px"},attrs:{type:"button"},on:{click:function(a){return a.preventDefault(),t.addCoupon.apply(null,arguments)}}},[t._v("套用優惠碼")]),a("input",{directives:[{name:"model",rawName:"v-model",value:t.couponCode,expression:"couponCode"}],staticClass:"float-right rounded-0",staticStyle:{height:"28px"},attrs:{type:"text",width:"40%",placeholder:"請輸入優惠碼"},domProps:{value:t.couponCode},on:{input:function(a){a.target.composing||(t.couponCode=a.target.value)}}})]),a("div",{staticClass:"clearfix"},[t.error.length>1?a("p",{staticClass:"text-danger float-right clearfix",staticStyle:{"margin-right":"132px"}},[t._v(t._s(this.error))]):t._e()]),a("div",{staticClass:"clearfix"},[a("a",{staticClass:"btn btn-primary btn-lg float-right text-white",staticStyle:{"margin-top":"10px"},attrs:{href:"#",type:"button"},on:{click:t.addCart}},[t._v("結帳去")])])])])])])},o=[function(){var t=this,a=t._self._c;return a("section",[a("div",{staticClass:"img"},[a("h2",[t._v("購物車")])])])},function(){var t=this,a=t._self._c;return a("div",{staticClass:"progress-wrap"},[a("h4",{staticClass:"text-center text-primary pt-5 font-weight-bold progressTitle"},[t._v("結帳進度")]),a("ul",{staticClass:"progressBar py-5"},[a("li",[t._v("0")]),a("li",[t._v("25")]),a("li",[t._v("50")]),a("li",[t._v("75")]),a("li",[t._v("100")])])])},function(){var t=this,a=t._self._c;return a("thead",[a("th",[t._v("品名")]),a("th",[t._v("數量")]),a("th",{staticClass:"smallPhoneHide"},[t._v("單價")]),a("th",[t._v("小計")]),a("th")])}],e=(s("14d9"),{data(){return{couponCode:"",isLoading:!1,error:"",productNum:1,total:0,cart:{},final_total:0,delCart:{},origin_carts:[]}},methods:{returnShop(){const t="https://vue-course-api.hexschool.io/api/secret78510/cart";this.$http.get(t).then(()=>{1===this.cart.carts.length&&(this.getCart(),this.$bus.$emit("message:push","購物車內無商品，請選購。"),this.$router.push("/product_list"))})},removeCart(t){const a=this.origin_carts.filter(a=>a.product_id===t),s=this;s.isLoading=!0;const i=a.map(async t=>{const a="https://vue-course-api.hexschool.io/api/cart/"+t.id;await s.$http.delete(a).then(()=>{})});Promise.allSettled([...i]).then(()=>{s.isLoading=!1,s.getCart(),s.returnShop()})},useAllCoupon(t){const a=t.filter(t=>t.coupon),s="https://vue-course-api.hexschool.io/api/secret78510/coupon",{code:i}=a[0].coupon;this.$http.post(s,{data:{code:i}}).then(t=>{t.data.success&&this.getCart()})},addCoupon(){const t="https://vue-course-api.hexschool.io/api/secret78510/coupon",a={code:this.couponCode};this.isLoading=!0,this.$http.post(t,{data:a}).then(t=>{t.data.success?(this.getCart(),this.isLoading=!1,this.error=""):(this.isLoading=!1,this.error="請輸入正確的優惠卷")})},getCart(){const t="https://vue-course-api.hexschool.io/api/secret78510/cart";this.isLoading=!0,this.$http.get(t).then(t=>{var a,s;const i=null===(a=t.data.data.carts)||void 0===a?void 0:a.filter(t=>t.coupon);if(null!==i&&void 0!==i&&i.length&&i.length<(null===(s=t.data)||void 0===s||null===(s=s.data)||void 0===s||null===(s=s.carts)||void 0===s?void 0:s.length))this.useAllCoupon(t.data.data.carts);else{this.origin_carts=[...t.data.data.carts],this.cart=t.data.data;const a=JSON.parse(JSON.stringify(this.cart)),s=new Map;a.carts.forEach(t=>{s.set(t.product.id,t)}),s.forEach(t=>{const a=t;a.qty=0,a.final_total=0,a.total=0}),s.forEach(t=>{const a=t;this.cart.carts.forEach(t=>{t.product_id===a.product_id&&(a.qty+=t.qty,a.final_total=t.final_total,a.total=t.total)})}),this.cart.carts.splice(0,this.cart.carts.length),s.forEach(t=>this.cart.carts.push(t)),this.isLoading=!1}})},addCart(){const t="https://vue-course-api.hexschool.io/api/secret78510/cart";let a="",s={};const i=this;(async function(o){if(await i.$http.get(t).then(t=>{i.delCart=t.data.data}),await i.delCart.carts.forEach(async t=>{a="https://vue-course-api.hexschool.io/api/secret78510/cart/"+t.id,await i.$http.delete(a).then(()=>{})}),await i.cart.carts.forEach(async a=>{s={product_id:a.product.id,qty:a.qty},await i.$http.post(t,{data:s}).then(()=>{})}),null!==(o=i.cart.carts)&&void 0!==o&&o.length&&i.cart.carts.some(t=>null===t||void 0===t?void 0:t.coupon)){var e;const t="https://vue-course-api.hexschool.io/api/secret78510/coupon",a=null===(e=i.cart.carts.find(t=>null===t||void 0===t?void 0:t.coupon))||void 0===e||null===(e=e.coupon)||void 0===e?void 0:e.code;await i.$http.post(t,{data:{code:a}}).then(()=>{})}i.$router.push("/order")})()},finalTotal(){this.total=0,this.final_total=0,this.cart.carts.forEach(t=>{var a,s;const i=t.product.price?t.product.price:t.product.origin_price,o=null!==(a=null===t||void 0===t||null===(s=t.coupon)||void 0===s?void 0:s.percent)&&void 0!==a?a:100;this.total+=t.qty*i,this.final_total+=t.qty*i*o/100})}},created(){this.getCart()},beforeUpdate(){this.finalTotal()}}),r=e,c=(s("88b0"),s("2877")),n=Object(c["a"])(r,i,o,!1,null,"41fde6e7",null);a["default"]=n.exports},b39a:function(t,a,s){}}]);
//# sourceMappingURL=chunk-87f0fed8.6a0b130c.js.map